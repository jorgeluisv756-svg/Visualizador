<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Visualizador de Municipios</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    html, body { height: 100%; margin: 0; padding: 0; }
    #map { height: 100%; width: 100%; }

    /* Logo institucional siempre arriba con fondo tenue */
    #logo {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 9999;
      background: rgba(255, 255, 255, 0.7);
      padding: 5px;
      border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    #logo img {
      width: 360px;
      height: auto;
      display: block;
      max-width: 90vw;
    }

    /* Panel lateral */
    #panel {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 1000;
      background: white;
      padding: 10px;
      border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      font-family: Arial, sans-serif;
      width: 240px;
      max-width: 90vw;
    }
    #panel h3 { margin-top: 0; font-size: 14px; text-align: center; }

    /* Leyenda */
    #legend {
      margin-top: 10px;
      font-size: 12px;
      display: none; /* visible solo con 1er informe */
    }
    #legend div {
      display: flex;
      align-items: center;
      margin-bottom: 4px;
    }
    #legend span {
      display: inline-block;
      width: 20px;
      height: 20px;
      margin-right: 6px;
    }

    @media (max-width: 600px) {
      #logo img { width: 200px; }
      #panel { width: 180px; font-size: 12px; }
    }
  </style>
</head>
<body>
  <!-- Logo institucional -->
  <div id="logo">
    <img src="https://raw.githubusercontent.com/jorgeluisv756-svg/imagenes_kmz/7c7924c0d0c89c5adaf112d1b8e3fb9db3258400/Logotipo%20armas30%20(1).png" alt="Logo Institucional">
  </div>

  <!-- Panel lateral -->
  <div id="panel">
    <h3>Selecciona mapa</h3>
    <label><input type="radio" name="mapOption" value="informe1"> Tu Experiencia Transforma 1er Informe</label><br>
    <label><input type="radio" name="mapOption" value="informe2"> Tu Experiencia Transforma 2do Informe</label>
    <div id="legend"><strong>INVERSIÓN</strong></div>
  </div>

  <!-- Contenedor del mapa -->
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // Inicializar mapa
    var map = L.map('map').setView([20.1, -98.7], 8);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    // Capas base
    var municipiosLayer, regionesLayer, edoLayer;

    // Municipios (gris claro, sin relleno)
    fetch('Municipios.geojson')
      .then(res => res.json())
      .then(data => {
        municipiosLayer = L.geoJSON(data, {
          style: { color: "#999", weight: 1, fillOpacity: 0 }
        }).addTo(map);
      });

    // Regiones (negro, 2pt, punto-línea-punto)
    fetch('Regiones.geojson')
      .then(res => res.json())
      .then(data => {
        regionesLayer = L.geoJSON(data, {
          style: {
            color: "#000",
            weight: 2,
            fillOpacity: 0,
            dashArray: "1,6,1,6"
          }
        }).addTo(map);
      });

    // Edo_Hgo (rojo, sin relleno)
    fetch('Edo_Hgo.geojson')
      .then(res => res.json())
      .then(data => {
        edoLayer = L.geoJSON(data, {
          style: {
            color: "rgb(255,0,0)",
            weight: 3,
            fillOpacity: 0
          }
        }).addTo(map);
      });

    // Segmentación por inversión (aplica a 1er y 2do informe)
    function estiloPorInversion(valor) {
      if (valor <= 0) return { fillColor: "rgb(204,204,204)", color: "#333", weight: 1, fillOpacity: 0.7 };
      else if (valor <= 66000) return { fillColor: "rgb(245,230,210)", color: "#333", weight: 1, fillOpacity: 0.7 };
      else if (valor <= 126000) return { fillColor: "rgb(225,200,150)", color: "#333", weight: 1, fillOpacity: 0.7 };
      else if (valor <= 240000) return { fillColor: "rgb(180,150,100)", color: "#333", weight: 1, fillOpacity: 0.7 };
      else return { fillColor: "rgb(137,112,68)", color: "#333", weight: 1, fillOpacity: 0.7 };
    }

    // Informes
    var informe1Layer, informe2Layer;
    var informesData; // cache de TuExpTrans

    // Cargar TuExpTrans una sola vez
    fetch('TuExpTrans.geojson')
      .then(res => res.json())
      .then(data => { informesData = data; })
      .catch(err => console.error('Error cargando TuExpTrans.geojson:', err));

    // Crear capas de informes bajo demanda
    function crearInforme1() {
      if (!informesData) return;
      if (informe1Layer) map.removeLayer(informe1Layer);
      informe1Layer = L.geoJSON(informesData, {
        // Filtra si necesitas excluir features sin dato (opcional)
        filter: f => typeof f.properties.ExpTra1eIn === 'number',
        style: f => estiloPorInversion(f.properties.ExpTra1eIn)
      });
    }

    function crearInforme2() {
      if (!informesData) return;
      if (informe2Layer) map.removeLayer(informe2Layer);
      informe2Layer = L.geoJSON(informesData, {
        filter: f => typeof f.properties.ExpTra2dIn === 'number',
        style: f => estiloPorInversion(f.properties.ExpTra2dIn)
      });
    }

    // Utilidades de visualización
    var legendDiv = document.getElementById('legend');
    var radios = document.getElementsByName('mapOption');

    function limpiarInformes() {
      if (informe1Layer) map.removeLayer(informe1Layer);
      if (informe2Layer) map.removeLayer(informe2Layer);
    }

    function mostrarMapaBase() {
      if (!map.hasLayer(municipiosLayer) && municipiosLayer) municipiosLayer.addTo(map);
      if (!map.hasLayer(regionesLayer) && regionesLayer) regionesLayer.addTo(map);
      if (!map.hasLayer(edoLayer) && edoLayer) edoLayer.addTo(map);
    }

    function ocultarMapaBase() {
      if (municipiosLayer) map.removeLayer(municipiosLayer);
      if (regionesLayer) map.removeLayer(regionesLayer);
      if (edoLayer) map.removeLayer(edoLayer);
    }

    // Mostrar mapa base al inicio
    mostrarMapaBase();

    // Eventos de selección
    Array.from(radios).forEach(radio => {
      radio.addEventListener('change', function(e) {
        const v = e.target.value;
        limpiarInformes();
        ocultarMapaBase();

        if (v === 'informe1') {
          if (!informe1Layer) crearInforme1();
          if (informe1Layer) informe1Layer.addTo(map);
          legendDiv.style.display = "block";
        } else if (v === 'informe2') {
          if (!informe2Layer) crearInforme2();
          if (informe2Layer) informe2Layer.addTo(map);
          legendDiv.style.display = "none";
        }
      });
    });

    // Asegurar que si no hay selección se muestre el mapa base
    function asegurarMapaBaseSiNoSeleccion() {
      const seleccionado = Array.from(radios).some(r => r.checked);
      if (!seleccionado) {
        limpiarInformes();
        mostrarMapaBase();
        legendDiv.style.display = "none";
      }
    }
    window.addEventListener('load', asegurarMapaBaseSiNoSeleccion);
    document.addEventListener('click', asegurarMapaBaseSiNoSeleccion);

    // Construir la leyenda de INVERSIÓN (1er informe)
    var segmentos = [
      { color: "rgb(204,204,204)", label: "Sin inversión" },
      { color: "rgb(245,230,210)", label: "$1 - $66,000" },
      { color: "rgb(225,200,150)", label: "$66,001 - $126,000" },
      { color: "rgb(180,150,100)", label: "$126,001 - $240,000" },
      { color: "rgb(137,112,68)", label: "$240,001 - $1,122,000" }
    ];
    segmentos.forEach(s => {
      var row = document.createElement('div');
      var box = document.createElement('span');
      box.style.background = s.color;
      row.appendChild(box);
      row.appendChild(document.createTextNode(s.label));
      legendDiv.appendChild(row);
    });
  </script>
</body>
</html>
